<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –∏ –≤–≤–æ–¥ –≥–æ—Ä–æ–¥–∞</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    #map {
      height: 400px;
      width: 100%;
      margin-top: 20px;
    }
    input, button {
      padding: 10px;
      font-size: 16px;
      margin: 5px 0;
      display: block;
    }
    .info {
      margin-top: 15px;
      background-color: #f1f1f1;
      padding: 10px;
      border-left: 4px solid #2196F3;
    }
  </style>
</head>
<body>
  <h2>–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –∏ –≤—ã–±–æ—Ä –≥–æ—Ä–æ–¥–∞</h2>

  <div class="info">
    üìç <strong>–í–∞–∂–Ω–æ:</strong> –≤–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –Ω–µ—Ç–æ—á–Ω–æ ‚Äî –æ—Å–æ–±–µ–Ω–Ω–æ –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ –±–µ–∑ GPS.<br>
    üëâ –ï—Å–ª–∏ –≤—ã –Ω–µ –≤ —Ç–æ–º –≥–æ—Ä–æ–¥–µ, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç–∞, –ø—Ä–æ—Å—Ç–æ –≤–≤–µ–¥–∏—Ç–µ –Ω—É–∂–Ω—ã–π –≥–æ—Ä–æ–¥ –≤—Ä—É—á–Ω—É—é –Ω–∏–∂–µ.
  </div>

  <label for="nameInput">–í–∞—à–µ –∏–º—è:</label>
  <input type="text" id="nameInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è" />

  <label for="cityInput">–ì–æ—Ä–æ–¥:</label>
  <input type="text" id="cityInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞" />

  <button id="showCityBtn">–ü–æ–∫–∞–∑–∞—Ç—å –≥–æ—Ä–æ–¥</button>

  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
  <script>
    let map;
    let userMarker;
    let cityMarker;

    function initMap(lat, lon) {
      map = L.map('map').setView([lat, lon], 11);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
      }).addTo(map);
    }

    
          },
          (err) => {
            alert('–û—à–∏–±–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏: ' + err.message);
            initMap(50.4501, 30.5234); // –ö–∏–µ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
          }
        );
      } else {
        alert('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–∞—à–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º');
        initMap(50.4501, 30.5234);
      }
    };

    document.getElementById('showCityBtn').addEventListener('click', async () => {
      const name = document.getElementById('nameInput').value.trim();
      const city = document.getElementById('cityInput').value.trim();

      if (!name) {
        alert('–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
        return;
      }
      if (!city) {
        alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞');
        return;
      }

      try {
        const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(city + ', –£–∫—Ä–∞–∏–Ω–∞')}`);
        const results = await response.json();

        if (results.length === 0) {
          alert('–ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω');
          return;
        }

        const lat = parseFloat(results[0].lat);
        const lon = parseFloat(results[0].lon);

        if (cityMarker) {
          map.removeLayer(cityMarker);
        }

        cityMarker = L.marker([lat, lon]).addTo(map)
          .bindPopup(`${name} –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –≥–æ—Ä–æ–¥–µ: ${city}`)
          .openPopup();

        map.setView([lat, lon], 12);

      } catch (error) {
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –≥–æ—Ä–æ–¥–∞');
        console.error(error);
      }
    });
  </script>
</body>
</html>
